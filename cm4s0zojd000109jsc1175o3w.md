---
title: "Kubeadm Installation on Master and Worker Nodes"
datePublished: Tue Dec 17 2024 05:30:57 GMT+0000 (Coordinated Universal Time)
cuid: cm4s0zojd000109jsc1175o3w
slug: kubeadm-installation-on-master-and-worker-nodes
cover: https://cdn.hashnode.com/res/hashnode/image/upload/v1760877725160/46289529-c35b-41eb-b840-72030478858b.png
tags: aws, kubernetes, google, devops, hashnode, linkedin, 90daysofdevops

---

## **Table of contents**

* [What is Deployment in k8s?](https://namg.hashnode.dev/kubeadm-installation-on-master-and-worker-nodes-day31-day32#heading-what-is-deployment-in-k8s)
    
    * [Pre-requisites:](https://namg.hashnode.dev/kubeadm-installation-on-master-and-worker-nodes-day31-day32#heading-pre-requisites)
        
    * [Master Node & Worker Node Setup:](https://namg.hashnode.dev/kubeadm-installation-on-master-and-worker-nodes-day31-day32#heading-master-node-amp-worker-node-setup)
        
    * [Running Nginx Pod on K8s: Part-1](https://namg.hashnode.dev/kubeadm-installation-on-master-and-worker-nodes-day31-day32#heading-running-nginx-pod-on-k8s-part-1)
        
    * [Running django-todo-cicd Pod : Part-2](https://namg.hashnode.dev/kubeadm-installation-on-master-and-worker-nodes-day31-day32#heading-running-django-todo-cicd-pod-part-2)
        

## What is Deployment in k8s?

A Deployment provides a configuration for updates for Pods and ReplicaSets.

You describe a desired state in a Deployment, and the Deployment Controller changes the actual state to the desired state at a controlled rate. You can define Deployments to create new replicas for scaling, or to remove existing Deployments and adopt all their resources with new Deployments.

**Create one Deployment file to deploy a sample todo-app on K8s using "Auto-healing" and "Auto-Scaling" feature**

* add a deployment.yml file (sample is kept in the folder for your reference)
    
* apply the deployment to your k8s (minikube) cluster by command `kubectl apply -f deployment.yml`
    

### Pre-requisites:

* Ubuntu OS (Xenial or later)
    
* sudo privileges
    
* Internet access
    
* t2.medium instance type or higher
    

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693059332372/8e409d72-27ac-444e-b4b5-4129b47be228.png?auto=compress,format&format=webp align="left")

### Master Node & Worker Node Setup:

<mark>Run the following commands on both the master and worker nodes to prepare them for kubeadm.</mark>  
\# using 'sudo su' is not a good practice. `sudo apt update sudo apt-get install -y apt-transport-https ca-certificates curl sudo apt install` [`docker.io`](http://docker.io/) `-y` `sudo systemctl enable --now docker` # enable and start in single command. # Adding GPG keys. `curl -fsSL "`[`https://packages.cloud.google.com/apt/doc/apt-key.gpg`](https://packages.cloud.google.com/apt/doc/apt-key.gpg)`" | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/kubernetes-archive-keyring.gpg` # Add the repository to the sourcelist. `echo 'deb` [`https://packages.cloud.google.com/apt`](https://packages.cloud.google.com/apt) `kubernetes-xenial main' | sudo tee /etc/apt/sources.list.d/kubernetes.list`  
`sudo apt update sudo apt install kubeadm=1.20.0-00 kubectl=1.20.0-00 kubelet=1.20.0-00 -y`

**<mark>Master Node</mark>**

1. Initialize the Kubernetes master node: `sudo kubeadm init`
    
2. Set up local kubeconfig (both for root user and normal user):  
    `mkdir -p $HOME/.kube`  
    `sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config`  
    `sudo chown $(id -u):$(id -g) $HOME/.kube/config`
    
3. Apply Weave network:  
    `kubectl apply -f` [`https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml`](https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml)
    
4. Generate a token for worker nodes to join:  
    `sudo kubeadm token create --print-join-command`
    
5. Expose port 6443 in the Security group for the Worker to connect to Master Node:
    
    ![image](https://user-images.githubusercontent.com/40052830/261848106-b3f5df01-acb0-419f-aa70-6d51819f4ec0.png align="left")
    

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693059488379/8dba4f7c-4272-4d8f-b52e-1fc20ccc3b3b.png?auto=compress,format&format=webp align="left")

**<mark>Worker-Node</mark>**

1. Run the following commands on the worker node.  
    `sudo kubeadm reset pre-flight checks`
    
2. Paste the join command you got from the master node and append `--v=5` at the end. *Make sure either you are working as sudo user or use* `sudo` before the command
    
3. After succesful join-&gt;
    

![image](https://user-images.githubusercontent.com/40052830/261848460-c530b65a-4afd-4b1d-9748-421c216d64cd.png align="left")

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693059560290/81fc4971-191b-42e6-85db-12aa36b6592d.png?auto=compress,format&format=webp align="left")

**<mark>Verify Cluster Connection</mark>**

On Master Node: `kubectl get nodes`

On Worker Node: `docker ps`

---

### Running Nginx Pod on K8s: Part-1

<mark>Making a directory 'Projects &gt; nginx' to create and store all required manifest files.</mark>

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693051519833/916b4568-25bb-4a3a-a2a1-3af480899645.png?auto=compress,format&format=webp align="left")

<mark>Creating namespace and writing manifest file for pod.yml</mark>

*\[Purpose of creating Namespace: Namespaces are used to create isolated environments within a cluster. They help in organizing and segmenting resources like pods, services, and deployments. By using namespaces, you can have multiple projects or teams sharing the same cluster without interfering with each other's resources. It also helps prevent naming conflicts and provides better resource management and access control\]*

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693052141301/2cfd7e0b-9bb9-493d-8133-95ff059e7c1c.png?auto=compress,format&format=webp align="left")

<mark>After writing pod.yml file we need to create pod, to create pod we need to run command:</mark> `kubectl apply -f pod.yml`

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693052386895/130bfede-d4ef-4663-8733-ef09f6a4ecd4.png?auto=compress,format&format=webp align="left")

<mark>You can verify from workernode that nginx container created through </mark> : `docker ps`

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693052496750/de973a84-4279-4b91-bb97-61a5f86d5bf2.png?auto=compress,format&format=webp align="left")

<mark>We can check the same on the Master node as well through:</mark> `kubectl get pods -n nginx`

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693052673063/24e1cf7d-b436-4ccb-b77a-7d1ea52afa62.png?auto=compress,format&format=webp align="left")

<mark>Creating Deployment manifest file:</mark> \[we create deployment manifest file tp manage deployments and scaling of a set of pods. The deployment manifest file serves as a blueprint for creating and maintaining the desired number of identical pods running your application.\]

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693054020686/5d772647-6eac-49a4-bd7e-f8879ab724bf.png?auto=compress,format&format=webp align="left")

<mark>Creating deployment manifest file </mark> : `kubectl apply -f deployment.yml -n nginx`

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693053868157/870b2dd9-14b9-49b3-a979-04bac840c311.png?auto=compress,format&format=webp align="left")

<mark>You can see created deployment pods</mark> : `kubectl get pods -n nginx`

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693053981680/83982b38-63c2-4a40-87c7-386fc6d0b114.png?auto=compress,format&format=webp align="left")

<mark>To get more information about the deployment run:</mark>  
`kubectl describe deployment nginx-deployment -n nginx`

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693054450245/4a02431d-6aef-41b3-8c38-14035f4777f6.png?auto=compress,format&format=webp align="left")

Trying rolling update: `kubectl scale deployment nginx-deployment --replicas=2 -n nginx`

\[*Rolling update is a way to perform updates or changes to your application without causing service disruptions\]*

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693054667284/54279f52-98fe-4b00-bfa4-45d174e19fca.png?auto=compress,format&format=webp align="left")

<mark>Though Nginx is running however it is not accessible through port 80</mark>

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693055249758/0fe67fca-f9f8-46f7-8c6c-9a8fe4b8a0e8.png?auto=compress,format&format=webp align="left")

To access nginx in the Kubernetes cluster, we need to create a service manifest file.  
\[*A Service manifest file is an abstraction that provides a stable IP address and a DNS name for a set of pods in a deployment, making it easy to expose those pods to other services within or outside the cluster. A Service manifest file allows you to define networking rules for how your pods can be accessed by other parts of the application or external users\]*

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693055916107/90791e88-65d3-466c-8cff-dd030c2d31f0.png?auto=compress,format&format=webp align="left")

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693056021257/2a53d374-2f9e-47d7-82df-2a6a8ae60b31.png?auto=compress,format&format=webp align="left")

<mark>To check the created service in Kubernetes:</mark>  
`kubectl get service -n nginx`

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693056274888/84078f50-72e9-47a6-99bc-aff110aa1ead.png?auto=compress,format&format=webp align="left")

<mark>Open port 30007 in Workernode inbound rules</mark>

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693056510840/2e86a969-651c-41d9-a674-bc5771626d51.png?auto=compress,format&format=webp align="left")

<mark>Accessing Nginx pod</mark>

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693056473910/c3801f4e-438e-48c4-9da6-ffc06559b45c.png?auto=compress,format&format=webp align="left")

---

### Running django-todo-cicd Pod : Part-2

<mark>Clone django todo cice app from this repo: </mark> [**https://github.com/LondheShubham153/django-todo-cicd**](https://github.com/LondheShubham153/django-todo-cicd)

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693056835938/1678b398-2c67-4cf0-81b8-16c7e5999bd2.png?auto=compress,format&format=webp align="left")

<mark>Creating a namespace for Django app</mark>

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693057301088/1aedc439-16c4-4909-9786-bc5c5bb2089c.png?auto=compress,format&format=webp align="left")

<mark>Updating pod.yaml</mark>

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693057730368/ef263b30-2bfe-40ec-9ec0-1c30cc6be628.png?auto=compress,format&format=webp align="left")

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693057679206/5809362b-9e50-467a-91ba-cdb78b6b48e4.png?auto=compress,format&format=webp align="left")

<mark>Updating deployment.yaml</mark>

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693057937049/e4e8343c-5ae5-40b7-8d9a-a6afd9d9188b.png?auto=compress,format&format=webp align="left")

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693058050505/187abcf2-3662-4c9b-9c55-71614a26ec9d.png?auto=compress,format&format=webp align="left")

<mark>Updating service.yaml file</mark>

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693058201707/0d61b51f-2261-4261-b11f-589a105b78b0.png?auto=compress,format&format=webp align="left")

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693058504305/9041abb5-8f50-482a-ad9b-a790cfb93b8a.png?auto=compress,format&format=webp align="left")

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1693058616031/99034d8a-a9bf-4dce-9710-758a28359ce2.png?auto=compress,format&format=webp align="left")

> ***Thank you for reading my blog! Happy Learning!!!ðŸ˜Š***